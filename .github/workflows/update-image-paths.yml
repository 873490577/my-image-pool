name: Update Image Paths

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update-image-paths:
    runs-on: ubuntu-latest
    
    steps:
    # 1. æ£€å‡ºä»£ç 
    - name: Checkout repository
      uses: actions/checkout@v4
    
    # 2. è®¾ç½®Pythonï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
    - name: Setup Python
      run: |
        sudo apt-get update
        python3 --version
    
    # 3. è¿è¡Œæˆ‘ä»¬çš„è„šæœ¬
    - name: Generate image paths
      run: |
        echo "å¼€å§‹ç”Ÿæˆå›¾ç‰‡è·¯å¾„ç´¢å¼•..."
        python3 scripts/generate_image_paths.py
        echo "ç”Ÿæˆå®Œæˆï¼"
    
    # 4. æ˜¾ç¤ºç»“æœ
    - name: Show results
      run: |
        if [ -f "image_paths.json" ]; then
          echo "âœ… JSONæ–‡ä»¶å·²ç”Ÿæˆ"
          echo "é¢„è§ˆå‰5è¡Œ:"
          head -5 image_paths.json
        else
          echo "âŒ ç”Ÿæˆå¤±è´¥"
          exit 1
        fi
    
    # 5. æäº¤æ›´æ”¹
    - name: Commit changes
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        # æ·»åŠ æ–‡ä»¶
        git add image_paths.json
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–
        if git diff --cached --quiet; then
          echo "æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æäº¤"
        else
          git commit -m "ğŸ“¸ Auto-update image paths [skip ci]"
          git push
          echo "âœ… å·²æäº¤å¹¶æ¨é€æ›´æ”¹"
        fi
