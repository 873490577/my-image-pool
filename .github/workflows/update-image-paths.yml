name: Update Image Paths

on:
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout with PAT
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    - name: Generate image paths
      run: python scripts/generate_image_paths.py
    
    - name: Configure Git with PAT
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        # ä½¿ç”¨PATè¿›è¡Œè®¤è¯
        git remote set-url origin https://x-access-token:${{ secrets.PERSONAL_ACCESS_TOKEN }}@github.com/${{ github.repository }}
    
    - name: Commit and push
      run: |
        git add image_paths.json
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–
        if git diff --cached --quiet; then
          echo "æ²¡æœ‰å˜åŒ–ï¼Œè·³è¿‡æäº¤"
        else
          git commit -m "ğŸ“¸ Auto-update image paths [skip ci]"
          git pull --rebase origin ${{ github.ref_name }}
          git push origin ${{ github.ref_name }}
          echo "âœ… å·²æˆåŠŸæäº¤æ›´æ”¹"
        fi
